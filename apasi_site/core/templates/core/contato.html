{% extends 'core/base.html' %}
{% load static %}

{% block title %}Contato - Apasi Ambiental{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/contato.css' %}">
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <header class="text-center mb-5">
                <h1 class="display-5 fw-bold text-primary mb-3">Fale Conosco</h1>
                <p class="lead text-muted">Preencha o formulário abaixo e nossa equipe entrará em contato em breve.</p>
                <p class="lead text-muted">Caso queira entrar em contato através do WhatsApp ou E-mail:</p>
                <div class="d-flex justify-content-center gap-3 flex-wrap mb-4">
                    <a href="tel:+5563999282888" class="btn btn-outline-primary d-flex align-items-center">
                        <i class="bi bi-telephone-fill me-2"></i>+55 (63) 99928-2888
                    </a>
                    <a href="mailto:ambientallix.comercial01@gmail.com" class="btn btn-outline-primary d-flex align-items-center">
                        <i class="bi bi-envelope-fill me-2"></i>ambientallix.comercial01@gmail.com
                    </a>
                </div>
            </header>

            <div class="card border-0 shadow-lg">
                <div class="card-body p-4 p-md-5">
                    <form method="POST" novalidate class="needs-validation" id="contactForm" aria-labelledby="formTitle">
                        {% csrf_token %}
                        <h2 id="formTitle" class="sr-only">Formulário de Contato</h2>

                        <!-- Informações Pessoais -->
                        <section class="mb-4">
                            <h3 class="h4 text-primary mb-3 border-bottom pb-2">
                                <i class="bi bi-person-circle me-2"></i>Informações Pessoais
                            </h3>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        {{ form.nome }}
                                        <label for="{{ form.nome.id_for_label }}">Nome Completo *</label>
                                        {% if form.nome.errors %}
                                            <div class="invalid-feedback">{{ form.nome.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        {{ form.email }}
                                        <label for="{{ form.email.id_for_label }}">E-mail *</label>
                                        {% if form.email.errors %}
                                            <div class="invalid-feedback">{{ form.email.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        {{ form.telefone }}
                                        <label for="{{ form.telefone.id_for_label }}">Telefone *</label>
                                        {% if form.telefone.errors %}
                                            <div class="invalid-feedback">{{ form.telefone.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Identificação -->
                        <section class="mb-4">
                            <h3 class="h4 text-primary mb-3 border-bottom pb-2">
                                <i class="bi bi-card-checklist me-2"></i>Identificação
                            </h3>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        {{ form.tipo_pessoa }}
                                        <label for="{{ form.tipo_pessoa.id_for_label }}">Tipo de Pessoa *</label>
                                        {% if form.tipo_pessoa.errors %}
                                            <div class="invalid-feedback">{{ form.tipo_pessoa.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6" id="cpfField">
                                    <div class="form-floating">
                                        {{ form.cpf }}
                                        <label for="{{ form.cpf.id_for_label }}">CPF</label>
                                        {% if form.cpf.errors %}
                                            <div class="invalid-feedback">{{ form.cpf.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6 d-none" id="cnpjField">
                                    <div class="form-floating">
                                        {{ form.cnpj }}
                                        <label for="{{ form.cnpj.id_for_label }}">CNPJ</label>
                                        {% if form.cnpj.errors %}
                                            <div class="invalid-feedback">{{ form.cnpj.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Endereço -->
                        <section class="mb-4">
                            <h3 class="h4 text-primary mb-3 border-bottom pb-2">
                                <i class="bi bi-geo-alt-fill me-2"></i>Endereço para Coleta
                            </h3>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="form-floating">
                                        {{ form.cep }}
                                        <label for="{{ form.cep.id_for_label }}">CEP *</label>
                                        {% if form.cep.errors %}
                                            <div class="invalid-feedback">{{ form.cep.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-floating">
                                        {{ form.rua }}
                                        <label for="{{ form.rua.id_for_label }}">Rua *</label>
                                        {% if form.rua.errors %}
                                            <div class="invalid-feedback">{{ form.rua.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-floating">
                                        {{ form.numero }}
                                        <label for="{{ form.numero.id_for_label }}">Número *</label>
                                        {% if form.numero.errors %}
                                            <div class="invalid-feedback">{{ form.numero.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        {{ form.complemento }}
                                        <label for="{{ form.complemento.id_for_label }}">Complemento</label>
                                        {% if form.complemento.errors %}
                                            <div class="invalid-feedback">{{ form.complemento.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        {{ form.bairro }}
                                        <label for="{{ form.bairro.id_for_label }}">Bairro *</label>
                                        {% if form.bairro.errors %}
                                            <div class="invalid-feedback">{{ form.bairro.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-floating">
                                        {{ form.cidade }}
                                        <label for="{{ form.cidade.id_for_label }}">Cidade *</label>
                                        {% if form.cidade.errors %}
                                            <div class="invalid-feedback">{{ form.cidade.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-floating">
                                        {{ form.estado }}
                                        <label for="{{ form.estado.id_for_label }}">UF *</label>
                                        {% if form.estado.errors %}
                                            <div class="invalid-feedback">{{ form.estado.errors|join:", " }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Política de Privacidade -->
                        <div class="form-check mb-4">
                            {{ form.aceita_politica }}
                            <label class="form-check-label" for="{{ form.aceita_politica.id_for_label }}">
                                Li e aceito a <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#politicaModal">política de privacidade</a> *
                            </label>
                            {% if form.aceita_politica.errors %}
                                <div class="invalid-feedback d-block">{{ form.aceita_politica.errors|join:", " }}</div>
                            {% endif %}
                        </div>

                        <!-- Botão -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg py-3" aria-label="Enviar formulário de contato">
                                <i class="bi bi-send-fill me-2"></i>Enviar Mensagem
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Política de Privacidade -->
<div class="modal fade" id="politicaModal" tabindex="-1" aria-labelledby="politicaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="politicaModalLabel">Política de Privacidade</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <p>A <strong>Apasi Ambiental</strong> valoriza a privacidade e a proteção dos dados pessoais de seus usuários, em conformidade com a <strong>Lei Geral de Proteção de Dados (Lei nº 13.709/2018 - LGPD)</strong>. Esta política visa esclarecer como coletamos, utilizamos, armazenamos e protegemos as informações fornecidas por você.</p>

                <h6 class="mt-4">1. Coleta de Dados Pessoais</h6>
                <p>Coletamos dados pessoais fornecidos voluntariamente por você por meio de nossos formulários, como:</p>
                <ul>
                    <li>Nome completo</li>
                    <li>E-mail</li>
                    <li>Telefone</li>
                    <li>CPF ou CNPJ</li>
                    <li>Endereço</li>
                </ul>

                <h6 class="mt-4">2. Finalidade do Tratamento</h6>
                <p>Os dados coletados são utilizados exclusivamente para as seguintes finalidades:</p>
                <ul>
                    <li>Atendimento de solicitações e prestação de serviços contratados;</li>
                    <li>Envio de comunicações relacionadas às suas demandas;</li>
                    <li>Aprimoramento contínuo de nossos serviços e processos internos.</li>
                </ul>

                <h6 class="mt-4">3. Compartilhamento de Dados</h6>
                <p>Não compartilhamos seus dados com terceiros, exceto nas seguintes hipóteses:</p>
                <ul>
                    <li>Mediante seu consentimento expresso;</li>
                    <li>Para cumprimento de obrigações legais ou ordens judiciais.</li>
                </ul>

                <h6 class="mt-4">4. Segurança da Informação</h6>
                <p>Adotamos medidas técnicas e administrativas para garantir a segurança, integridade e confidencialidade dos seus dados, protegendo-os contra acessos não autorizados, vazamentos ou qualquer forma de tratamento inadequado.</p>

                <h6 class="mt-4">5. Direitos do Titular</h6>
                <p>Nos termos da LGPD, você tem o direito de:</p>
                <ul>
                    <li>Acessar seus dados pessoais;</li>
                    <li>Solicitar correção de dados incompletos ou desatualizados;</li>
                    <li>Requerer a exclusão de dados desnecessários ou tratados em desconformidade com a legislação;</li>
                    <li>Revogar o consentimento, quando aplicável.</li>
                </ul>
                <p>Para exercer seus direitos, entre em contato conosco por meio dos canais disponíveis no site.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Entendi</button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
    $(document).ready(function() {
        // Máscaras
        $('#id_telefone').mask('(00) 00000-0000');
        $('#id_cep').mask('00000-000');
        $('#id_cpf').mask('000.000.000-00');
        $('#id_cnpj').mask('00.000.000/0000-00');

        // Busca de CEP
        $('#id_cep').on('blur', async function() {
            const cep = $(this).val().replace(/\D/g, '');
            if (cep.length === 8) {
                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();
                    if (!data.erro) {
                        $('#id_rua').val(data.logradouro);
                        $('#id_bairro').val(data.bairro);
                        $('#id_cidade').val(data.localidade);
                        $('#id_estado').val(data.uf);
                    } else {
                        alert('CEP não encontrado.');
                    }
                } catch (error) {
                    alert('Erro ao buscar o CEP.');
                }
            }
        });

        // Alternar CPF/CNPJ
        $('#id_tipo_pessoa').on('change', function() {
            const value = $(this).val();
            $('#cpfField, #cnpjField').addClass('d-none');
            $('#id_cpf, #id_cnpj').val('');
            if (value === 'Física') {
                $('#cpfField').removeClass('d-none');
            } else if (value === 'Jurídica') {
                $('#cnpjField').removeClass('d-none');
            }
        }).trigger('change');

        // Validação de política de privacidade
        $('#contactForm').on('submit', function(e) {
            if (!$('#id_aceita_politica').is(':checked')) {
                e.preventDefault();
                alert('Por favor, aceite a política de privacidade.');
                $('#politicaModal').modal('show');
            }
        });
    });
</script>
{% endblock %}